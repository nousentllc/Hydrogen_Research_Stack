<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iowa & Nebraska Hydrogen Feasibility Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <!-- MathJax for rendering LaTeX math formulas -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['\\(', '\\)']] },
            startup: {
                typeset: true // Enable automatic typesetting on startup
            }
        };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Chosen Palette: Prairie Future (Slate-900, Amber-500, Sky-500, Stone-100) -->
    <!-- Application Structure Plan: 
         The app is designed as a 'Decision Support System' for stakeholders. 
         1. 'Executive Brief': High-level metrics and the 'Feasibility Score'.
         2. 'Geology & Extraction': Technical deep-dive into the Midcontinent Rift, utilizing a custom Canvas visualizer for strata.
         3. 'Economics & Ag': The core value proposition (Fertilizer/Ethanol) using interactive cost comparison charts.
         4. 'Midstream & I-80': Distribution costs across different modalities.
         5. 'MISO Grid & Adequacy': Analyzes wind Dunkelflaute and firm geologic capacity.
         6. 'MTEP24 Interconnection': Bypassing the DPP queue and IBR issues.
         7. 'Workforce & Cyber': IMPLAN jobs and Citrix audits.
         8. 'Risk & Regulation': Public sentiment simulator + AI Strategy generation.
         9. '10-Year Outlook': Monte Carlo style projections with uncertainty bands.
         10. 'AI Analyst': Embedded Gemini logic for conversational Q&A.
    -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f5f5f4; color: #1c1917; }
        .chart-container { 
            position: relative; 
            width: 100%; 
            max-width: 800px; 
            margin: 0 auto; 
            height: 400px; 
            max-height: 500px;
        }
        .nav-item.active { background-color: #f59e0b; color: #fff; font-weight: 700; }
        .nav-item { transition: all 0.2s; }
        .nav-item:hover:not(.active) { background-color: #e7e5e4; }
        .card { background: white; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .canvas-map { background-color: #e2e8f0; width: 100%; height: 300px; border-radius: 8px; cursor: crosshair; }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">

    <!-- Header -->
    <header class="bg-slate-900 text-white p-4 flex justify-between items-center shadow-lg z-10">
        <div>
            <h1 class="text-2xl font-bold tracking-tight text-amber-500">H2 Heartland Analysis</h1>
            <p class="text-xs text-slate-400">Midcontinent Rift Hydrogen Feasibility Study: IA & NE</p>
        </div>
        <div class="text-right hidden sm:block">
            <div class="text-sm font-semibold">Report Date: February 2026</div>
            <div class="text-xs text-slate-400">Status: <span class="text-green-400">High Potential</span></div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar Navigation -->
        <nav class="w-64 bg-white border-r border-stone-200 flex-shrink-0 flex flex-col overflow-y-auto hidden md:flex">
            <div class="p-4">
                <div class="text-xs font-bold text-stone-500 uppercase tracking-wider mb-2">Modules</div>
                <button onclick="nav('exec')" id="nav-exec" class="nav-item active w-full text-left px-4 py-3 rounded-lg mb-1 flex items-center">
                    <span>Executive Summary</span>
                </button>
                <button onclick="nav('geo')" id="nav-geo" class="nav-item w-full text-left px-4 py-3 rounded-lg mb-1 flex items-center">
                    <span>Geology & Purity</span>
                </button>
                <button onclick="nav('econ')" id="nav-econ" class="nav-item w-full text-left px-4 py-3 rounded-lg mb-1 flex items-center">
                    <span>Economics & GREET</span>
                </button>
                <button onclick="nav('infra')" id="nav-infra" class="nav-item w-full text-left px-4 py-3 rounded-lg mb-1 flex items-center border-l-4 border-transparent hover:border-amber-500">
                    <span>Midstream & I-80</span>
                </button>
                <button onclick="nav('miso')" id="nav-miso" class="nav-item w-full text-left px-4 py-3 rounded-lg mb-1 flex items-center border-l-4 border-transparent hover:border-amber-500">
                    <span>MISO Resource Adequacy</span>
                </button>
                <button onclick="nav('queue')" id="nav-queue" class="nav-item w-full text-left px-4 py-3 rounded-lg mb-1 flex items-center border-l-4 border-transparent hover:border-amber-500">
                    <span>MTEP24 & Interconnection</span>
                </button>
                <button onclick="nav('grid')" id="nav-grid" class="nav-item w-full text-left px-4 py-3 rounded-lg mb-1 flex items-center border-l-4 border-transparent hover:border-amber-500">
                    <span>Grid & Wind</span>
                </button>
                <button onclick="nav('workforce')" id="nav-workforce" class="nav-item w-full text-left px-4 py-3 rounded-lg mb-1 flex items-center border-l-4 border-transparent hover:border-amber-500">
                    <span>Workforce & Cyber</span>
                </button>
                <button onclick="nav('reg')" id="nav-reg" class="nav-item w-full text-left px-4 py-3 rounded-lg mb-1 flex items-center">
                    <span>Regulatory & Social</span>
                </button>
                <button onclick="nav('outlook')" id="nav-outlook" class="nav-item w-full text-left px-4 py-3 rounded-lg mb-1 flex items-center">
                    <span>10-Year Outlook</span>
                </button>
                <button onclick="nav('biblio')" id="nav-biblio" class="nav-item w-full text-left px-4 py-3 rounded-lg mb-1 flex items-center">
                    <span>Sources & Citations</span>
                </button>
                <button onclick="nav('ai')" id="nav-ai" class="nav-item w-full text-left px-4 py-3 rounded-lg mb-1 flex items-center bg-slate-900 text-white hover:bg-slate-800 shadow">
                    <span>AI Analyst ‚ú®</span>
                </button>
            </div>
            <div class="mt-auto p-4 bg-stone-50 border-t border-stone-200">
                <div class="text-xs text-stone-500">Research by: <br><strong>Automated Analyst Unit</strong></div>
            </div>
        </nav>

        <!-- Mobile Nav Toggle -->
        <div class="md:hidden absolute bottom-4 right-4 z-50">
            <button onclick="document.querySelector('nav').classList.toggle('hidden'); document.querySelector('nav').classList.toggle('absolute'); document.querySelector('nav').classList.toggle('h-full'); document.querySelector('nav').classList.toggle('z-40');" class="bg-amber-500 text-white p-3 rounded-full shadow-lg">
                ‚ò∞ Menu
            </button>
        </div>

        <!-- Main Content Area -->
        <main id="main-content" class="flex-1 overflow-y-auto p-6 bg-stone-100">
            <!-- Dynamic Content Injection Point -->
        </main>
    </div>

    <script>
        // --- Data & State ---
        const reportData = {
            exec: {
                title: "Executive Summary: The Hidden Giant",
                content: `
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="card p-6 border-l-4 border-amber-500">
                            <h3 class="text-sm font-bold text-stone-500 uppercase">Resource Potential</h3>
                            <div class="text-3xl font-bold text-slate-800 mt-2">High</div>
                            <p class="text-sm text-stone-600 mt-2">The Midcontinent Rift System (MRS) contains the necessary iron-rich ultramafic rocks and thermal conditions for continuous abiotic hydrogen generation.</p>
                        </div>
                        <div class="card p-6 border-l-4 border-sky-500">
                            <h3 class="text-sm font-bold text-stone-500 uppercase">LCOH Projection</h3>
                            <div class="text-3xl font-bold text-slate-800 mt-2">$0.85<span class="text-sm font-normal text-stone-500">/kg</span></div>
                            <p class="text-sm text-stone-600 mt-2">Geologic extraction bypasses the massive energy penalties of electrolysis, heavily undercutting Green ($4+) and Grey ($1.50+) hydrogen.</p>
                        </div>
                        <div class="card p-6 border-l-4 border-red-500">
                            <h3 class="text-sm font-bold text-stone-500 uppercase">Primary Risk</h3>
                            <div class="text-3xl font-bold text-slate-800 mt-2">Public Trust</div>
                            <p class="text-sm text-stone-600 mt-2">Eminent domain controversies surrounding recent CO2 pipelines pose a severe threat to the necessary gathering and transmission infrastructure.</p>
                        </div>
                    </div>
                    <div class="card p-8">
                        <h2 class="text-xl font-bold text-slate-800 mb-4">Strategic Overview: A Paradigm Shift in Energy</h2>
                        <p class="text-stone-700 leading-relaxed mb-4">
                            Historically, hydrogen has been viewed purely as an energy <em>carrier</em>‚Äîa volatile gas that requires massive amounts of primary energy (natural gas or wind/solar electricity) to manufacture. The emerging discovery of <strong>Geologic (Gold) Hydrogen</strong> reclassifies it as a primary energy <em>source</em>. Iowa and Nebraska sit atop the <strong>Midcontinent Rift System (MRS)</strong>, a 1.1 billion-year-old tectonic scar loaded with iron-bearing minerals. When deep groundwater interacts with these rocks, a chemical process called serpentinization naturally yields continuous streams of hydrogen.
                        </p>
                        <p class="text-stone-700 leading-relaxed mb-4">
                            <strong>The 2026 OBBBA Pivot:</strong> With the recent passage of the One Big Beautiful Bill Act (OBBBA), federal industrial policy has radically shifted toward an "energy dominance" agenda. The sudden compression of the 45V Clean Hydrogen Production Credit runway (expiring for projects starting after 2027) and the stalling of federally funded regional hubs (like the Heartland Hub) has created a "year of reckoning." The industry must now pivot towards execution, supply chain independence, and private-capital efficiency. Geologic hydrogen, leveraging mature, domestic fossil-style extraction capabilities, is uniquely positioned to thrive in this new unsubsidized and accelerated market environment.
                        </p>
                        <p class="text-stone-700 leading-relaxed">
                            <strong>The "Ag-Energy" Nexus & Macro Impact:</strong> The immediate economic driver for IA/NE is not exporting hydrogen to coastal tech hubs, but aggressive internal consumption. Both states are heavyweights in corn and ethanol production, industries fundamentally dependent on nitrogen fertilizer (anhydrous ammonia). Indigenous hydrogen extraction offers a path to decarbonized, hyper-local fertilizer sovereignty. At a macro level, the <em>Road Map to a US Hydrogen Economy</em> projects hydrogen could meet 14% of US final energy demand by 2050, generating $750B in revenue and supporting 3.4 million jobs. The Midwest is uniquely positioned to capture a massive share of this value using existing conventional oil and gas drilling technologies.
                        </p>
                    </div>
                `
            },
            geo: {
                title: "Geology, Strata & Purity Deep-Dive",
                content: `
                    <div class="mb-6 p-6 bg-white rounded shadow border-l-4 border-slate-700">
                        <h3 class="text-xl font-bold text-slate-800 mb-3">The Midcontinent Rift System (MRS) Mechanics & Strata</h3>
                        <p class="text-sm text-stone-700 mb-4 leading-relaxed">
                            The MRS is a 1.1 billion-year-old (Mesoproterozoic) failed tectonic rift extending over 2,000 km, cutting directly through Iowa and Nebraska. It is characterized by a massive volume of dense, iron-rich mafic and ultramafic volcanic rocks (the Keweenawan Supergroup) pushed unusually close to the surface.
                        </p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                            <div>
                                <h4 class="font-bold text-sm text-amber-700 mb-2">Generation Mechanisms</h4>
                                <ul class="list-disc ml-5 text-sm text-stone-600 space-y-2">
                                    <li><strong>Serpentinization:</strong> Deep groundwater reacting with olivine/pyroxene-rich rocks at elevated temperatures (\\(>200^\\circ\\text{C}\\)) to form serpentine, magnetite, and free Hydrogen (\\(\\text{H}_2\\)).</li>
                                    <li><strong>Radiolysis:</strong> Natural radioactive decay of trace elements (U, Th, K) in the crust splitting trapped water molecules into Hydrogen and Oxygen.</li>
                                </ul>
                                <div class="bg-slate-100 p-4 rounded text-xs overflow-x-auto whitespace-nowrap mt-3 border border-slate-200 text-slate-800 text-center">
                                    $$3\\text{Fe}_2\\text{SiO}_4 \\text{ (Fayalite)} + 2\\text{H}_2\\text{O} \\rightarrow 2\\text{Fe}_3\\text{O}_4 \\text{ (Magnetite)} + 3\\text{SiO}_2 + 2\\text{H}_2$$
                                </div>
                            </div>
                            <div>
                                <h4 class="font-bold text-sm text-amber-700 mb-2">The "Goldilocks" Stratigraphy</h4>
                                <ul class="list-disc ml-5 text-sm text-stone-600 space-y-2">
                                    <li><strong>Source:</strong> Precambrian crystalline basement rocks containing high concentrations of ferrous iron (\\(\\text{Fe}^{2+}\\)).</li>
                                    <li><strong>Reservoir:</strong> Porous and permeable clastic sedimentary rocks (e.g., Oronto Group sandstones) overlying the basement.</li>
                                    <li><strong>Seal:</strong> <em>Crucial constraint.</em> \\(\\text{H}_2\\) is highly diffusive. Traditional hydrocarbon seals (shales) may be insufficient. Dense evaporite (salt) layers or highly mature, tight shales are required to trap the gas.</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="card p-6 flex flex-col justify-between">
                            <div>
                                <h3 class="font-bold text-lg mb-3 text-slate-800">Gas Purity & Separation Economics</h3>
                                <p class="text-sm text-stone-600 mb-4 leading-relaxed">
                                    Geologic hydrogen is rarely found at 100% purity. It migrates and accumulates in mixed-gas reservoirs. Understanding and managing these impurities is the primary driver of surface facility capital expenditures (CAPEX).
                                </p>
                                <ul class="text-sm text-stone-600 space-y-3 mb-6">
                                    <li><strong class="text-slate-800">Typical Composition:</strong> \\(\\text{H}_2\\) is frequently co-mingled with Nitrogen (\\(\\text{N}_2\\)), Methane (\\(\\text{CH}_4\\)), and Helium (\\(\\text{He}\\)). High concentrations of \\(\\text{N}_2\\) require energy-intensive separation if pure \\(\\text{H}_2\\) is required.</li>
                                    <li><strong class="text-amber-600">The Helium Kicker:</strong> The presence of Helium (often 1-3% in deep cratonic structures) dramatically alters economic feasibility. Helium is a high-value, scarce commodity. Co-extracting Helium can completely offset the cost of the expensive surface separation infrastructure (Pressure Swing Adsorption units and cryogenic separation) required to purify the \\(\\text{H}_2\\).</li>
                                    <li><strong class="text-slate-800">Target Purity:</strong> Fuel cell vehicles require >99.99% purity. However, local ammonia fertilizer production (the primary IA/NE use-case) can tolerate lower purities, drastically reducing extraction LCOH.</li>
                                </ul>
                            </div>
                            <div class="p-4 bg-stone-50 border border-stone-200 rounded shadow-sm">
                                <h4 class="font-bold text-sm text-slate-800 mb-1">USGS Prospectivity & Conventional Tech</h4>
                                <p class="text-xs text-stone-600 mb-3">
                                    Extraction utilizes <strong>conventional oil and gas drilling technology</strong>, eliminating the need for novel methods. View the structural boundaries mapped by the Federal government:
                                </p>
                                <a href="https://www.usgs.gov/tools/geologic-hydrogen-prospectivity-map-explorer" target="_blank" class="inline-block bg-sky-600 text-white text-xs font-bold px-3 py-2 rounded hover:bg-sky-700 transition shadow">
                                    Explore USGS Geologic H2 Map ‚Üí
                                </a>
                            </div>
                        </div>

                        <!-- Interactive Rift Explorer -->
                        <div class="card p-6 flex flex-col relative group">
                            <h3 class="font-bold text-lg mb-2 text-slate-800">Interactive Rift Explorer</h3>
                            <p class="text-xs text-stone-500 mb-2">Hover over hotspots for fault details. Adjust the slider to lower the drill bit.</p>
                            <div id="rift-canvas-container" class="flex-grow bg-slate-200 rounded relative overflow-hidden h-64 min-h-[250px] cursor-crosshair">
                                <canvas id="geoCanvas" class="w-full h-full absolute inset-0"></canvas>
                                <div id="geo-tooltip" class="absolute hidden bg-slate-900 text-white text-xs px-3 py-2 rounded shadow-lg pointer-events-none z-20 font-semibold border border-amber-500"></div>
                                <div class="absolute bottom-2 right-2 bg-white/90 p-2 rounded text-xs shadow pointer-events-none z-10">
                                    <div class="flex items-center"><span class="w-3 h-3 bg-red-500 rounded-full mr-2"></span> High \\(\\text{H}_2\\) Potential</div>
                                    <div class="flex items-center mt-1"><span class="w-3 h-3 bg-blue-300 rounded-full mr-2"></span> Aquifer/Low Pot.</div>
                                </div>
                            </div>
                            <div class="mt-4 z-10">
                                <label class="text-xs font-bold uppercase text-stone-500">Drill Depth Simulator (ft)</label>
                                <input type="range" id="depth-slider" min="1000" max="15000" value="5000" class="w-full mt-2 accent-amber-500" oninput="updateGeoSim(this.value)">
                                <div class="flex justify-between text-xs text-stone-500 mt-1">
                                    <span>1,000 ft</span>
                                    <span id="depth-val" class="font-bold text-amber-600">5,000 ft</span>
                                    <span>15,000 ft</span>
                                </div>
                                <div id="geo-result" class="mt-3 text-sm p-3 bg-stone-50 rounded border border-stone-200 min-h-[50px] flex items-center">
                                    Adjust depth to analyze strata potential.
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            econ: {
                title: "Advanced Economics & GREET Calculator",
                content: `
                    <div class="mb-6 p-4 bg-white rounded shadow border-l-4 border-green-500">
                        <h3 class="font-bold text-lg text-green-800">The "Golden" Opportunity vs. Subsidized Pathways</h3>
                        <p class="text-sm text-stone-600 mt-1">
                            Geologic Hydrogen skips the manufacturing phase entirely. However, to evaluate the true competitive landscape under the 2026 OBBBA, we must model the precise 45V and 45Q tax credits using the <strong>Argonne GREET model (referenced in 2024 AMR-09)</strong>.
                        </p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                         <!-- GREET Interactive Sliders -->
                        <div class="card p-6">
                            <h3 class="font-bold text-slate-800 mb-4">Carbon Intensity (CI) & Subsidies</h3>
                            <div class="space-y-5">
                                <div>
                                    <div class="flex justify-between text-sm font-semibold text-stone-700">
                                        <label>Grid CI ($\\text{kg CO}_2\\text{e / kg H}_2$)</label>
                                        <span id="val-gridci" class="text-amber-600">0.40</span>
                                    </div>
                                    <input type="range" id="slide-gridci" min="0" max="5" step="0.1" value="0.4" class="w-full accent-amber-500" oninput="updateCostChart()">
                                    <p class="text-xs text-stone-400 mt-1">Impacts Green H2 45V Tier (Incrementality/Temporal matching active).</p>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm font-semibold text-stone-700">
                                        <label>Carbon Capture Rate (%)</label>
                                        <span id="val-capture" class="text-blue-600">95%</span>
                                    </div>
                                    <input type="range" id="slide-capture" min="50" max="99" step="1" value="95" class="w-full accent-blue-500" oninput="updateCostChart()">
                                    <p class="text-xs text-stone-400 mt-1">Impacts Blue H2 45Q parity rate under OBBBA.</p>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm font-semibold text-stone-700">
                                        <label>Methane Leakage (%)</label>
                                        <span id="val-leakage" class="text-slate-600">1.0%</span>
                                    </div>
                                    <input type="range" id="slide-leakage" min="0" max="3" step="0.1" value="1.0" class="w-full accent-slate-500" oninput="updateCostChart()">
                                    <p class="text-xs text-stone-400 mt-1">Upstream emissions penalize Blue/Grey H2 CI scores.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Cost Comparator -->
                        <div class="card p-6">
                            <h3 class="font-bold text-slate-800 mb-2">Net LCOH Comparison ($/kg)</h3>
                            <p class="text-xs text-stone-500 mb-4">Calculated net cost after applying specific 45V/45Q subsidies based on the GREET parameters mapped to the left.</p>
                            <div class="chart-container" style="height: 200px;">
                                <canvas id="costChart"></canvas>
                            </div>
                            <div id="credit-status" class="mt-4 text-xs font-bold text-center p-2 rounded bg-stone-100">
                                45V Credit: $3.00/kg | 45Q Credit: $0.81/kg
                            </div>
                        </div>
                    </div>

                    <!-- Ag Loop Diagram -->
                    <div class="card p-6">
                        <h3 class="font-bold text-slate-800 mb-4">The Iowa/Nebraska Ag-Energy Loop</h3>
                        <p class="text-sm text-stone-600 mb-4">The path to profitability doesn't require thousands of miles of pipelines to coastal cities. The off-takers are already in the Midwest, ready to consume locally produced hydrogen to decarbonize agriculture.</p>
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-2 text-center items-center">
                            
                            <div class="p-4 bg-slate-100 rounded hover:bg-slate-200 transition cursor-pointer border border-slate-300 shadow-sm" onclick="showAgDetail('h2')">
                                <div class="text-2xl">‚ö°</div>
                                <div class="font-bold text-sm text-slate-800">1. Extraction</div>
                                <div class="text-xs text-slate-500">Local Gold H2</div>
                            </div>
                            <div class="hidden md:block text-slate-400 font-bold text-xl">‚Üí</div>
                            
                            <div class="p-4 bg-blue-100 rounded hover:bg-blue-200 transition cursor-pointer border border-blue-300 shadow-sm" onclick="showAgDetail('nh3')">
                                <div class="text-2xl">üíß</div>
                                <div class="font-bold text-sm text-blue-800">2. Ammonia</div>
                                <div class="text-xs text-blue-600">Green Fertilizer</div>
                            </div>
                            <div class="hidden md:block text-slate-400 font-bold text-xl">‚Üí</div>

                            <div class="p-4 bg-amber-100 rounded hover:bg-amber-200 transition cursor-pointer border border-amber-300 shadow-sm" onclick="showAgDetail('corn')">
                                <div class="text-2xl">üåΩ</div>
                                <div class="font-bold text-sm text-amber-800">3. Agriculture</div>
                                <div class="text-xs text-amber-600">Low-CI Feedstock</div>
                            </div>
                            <div class="hidden md:block text-slate-400 font-bold text-xl">‚Üí</div>

                            <div class="p-4 bg-green-100 rounded hover:bg-green-200 transition cursor-pointer border border-green-300 shadow-sm" onclick="showAgDetail('saf')">
                                <div class="text-2xl">‚úàÔ∏è</div>
                                <div class="font-bold text-sm text-green-800">4. Ethanol/SAF</div>
                                <div class="text-xs text-green-600">High-Value Fuel</div>
                            </div>

                        </div>
                        <div id="ag-detail" class="mt-6 p-5 bg-stone-50 border border-stone-200 rounded text-sm text-stone-700 shadow-inner min-h-[120px]">
                            <em>Select a stage above to explore the detailed economic and regulatory integration of this circular economy.</em>
                        </div>
                    </div>
                `
            },
            infra: {
                title: "Midstream Infrastructure & Freight",
                content: `
                    <div class="mb-6 p-4 bg-white rounded shadow border-l-4 border-slate-700">
                        <h3 class="font-bold text-lg text-slate-800">The I-80 Freight Corridor Logistics</h3>
                        <p class="text-sm text-stone-600 mt-1">
                            Based on the <strong>CAELP/ERM 2040 Projections</strong> and <strong>2024 AMR-06 (Infrastructure)</strong>, extraction is only half the battle. Delivering geologic hydrogen to heavy-duty (Class 8) trucking networks along the I-80 corridor (cutting through IA/NE) dictates the final dispensed cost.
                        </p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="card p-6">
                            <h3 class="font-bold text-slate-800 mb-4">I-80 Station Network Simulator</h3>
                            
                            <!-- Conceptual Map Graphic -->
                            <div class="w-full h-24 bg-stone-200 rounded-lg mb-6 relative flex items-center justify-between px-4 overflow-hidden border border-stone-300">
                                <div class="absolute inset-0 flex items-center justify-center opacity-20 text-4xl font-black text-stone-400">INTERSTATE 80</div>
                                <div class="w-full h-2 bg-slate-800 absolute top-1/2 transform -translate-y-1/2"></div>
                                <div class="flex justify-between w-full z-10" id="station-markers">
                                    <!-- Populated by JS -->
                                </div>
                            </div>

                            <label class="text-sm font-semibold text-stone-700 block mb-2">Class 8 H2 Fueling Stations to Deploy (1,000 kg/day each)</label>
                            <input type="range" id="slide-stations" min="1" max="50" step="1" value="10" class="w-full accent-amber-500 mb-2" oninput="updateInfra()">
                            <div class="flex justify-between text-xs text-stone-500 font-bold">
                                <span>1 Station</span>
                                <span id="val-stations" class="text-amber-600 text-lg">10 Stations</span>
                                <span>50 Stations</span>
                            </div>
                            
                            <div class="mt-6 p-4 bg-stone-50 rounded border border-stone-200">
                                <p class="text-xs text-stone-500 uppercase tracking-wide">Daily Corridor Demand</p>
                                <p class="text-2xl font-bold text-slate-800" id="val-demand">10,000 kg/day</p>
                            </div>
                        </div>

                        <div class="card p-6">
                            <h3 class="font-bold text-slate-800 mb-4">Delivery Modality CAPEX / OPEX</h3>
                            <p class="text-xs text-stone-500 mb-4">Modeled costs for distributing extracted Geologic H2 to the selected I-80 stations.</p>
                            
                            <div class="space-y-4">
                                <!-- Pipeline -->
                                <div class="p-3 border border-slate-200 rounded">
                                    <div class="flex justify-between items-center mb-1">
                                        <h4 class="text-sm font-bold text-slate-700">Dedicated Pipeline</h4>
                                        <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded">Best for High Volume</span>
                                    </div>
                                    <div class="w-full bg-stone-200 rounded-full h-2.5 mb-2"><div id="bar-pipe" class="bg-slate-700 h-2.5 rounded-full" style="width: 80%"></div></div>
                                    <div class="flex justify-between text-xs text-stone-600">
                                        <span id="capex-pipe">Capex: $520M</span>
                                        <span>Opex: Very Low ($0.50/kg)</span>
                                    </div>
                                </div>
                                <!-- Liquid -->
                                <div class="p-3 border border-slate-200 rounded">
                                    <div class="flex justify-between items-center mb-1">
                                        <h4 class="text-sm font-bold text-slate-700">Liquid Cryo Trucks</h4>
                                        <span class="text-xs px-2 py-1 bg-amber-100 text-amber-800 rounded">Best for Long Distance</span>
                                    </div>
                                    <div class="w-full bg-stone-200 rounded-full h-2.5 mb-2"><div id="bar-liquid" class="bg-amber-500 h-2.5 rounded-full" style="width: 40%"></div></div>
                                    <div class="flex justify-between text-xs text-stone-600">
                                        <span id="capex-liquid">Capex: $90M</span>
                                        <span>Opex: High ($2.50/kg)</span>
                                    </div>
                                </div>
                                <!-- Gaseous -->
                                <div class="p-3 border border-slate-200 rounded">
                                    <div class="flex justify-between items-center mb-1">
                                        <h4 class="text-sm font-bold text-slate-700">Gaseous Tube Trailers</h4>
                                        <span class="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded">Best for Early Adoption</span>
                                    </div>
                                    <div class="w-full bg-stone-200 rounded-full h-2.5 mb-2"><div id="bar-gas" class="bg-blue-500 h-2.5 rounded-full" style="width: 20%"></div></div>
                                    <div class="flex justify-between text-xs text-stone-600">
                                        <span id="capex-gas">Capex: $30M</span>
                                        <span>Opex: Very High ($3.50/kg)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            miso: {
                title: "MISO Resource Adequacy & Grid Reliability",
                content: `
                    <div class="mb-6 p-4 bg-white rounded shadow border-l-4 border-blue-500">
                        <h3 class="font-bold text-lg text-blue-800">The "Dunkelflaute" Advantage & UEVF Reliability</h3>
                        <p class="text-sm text-stone-600 mt-1">
                            Based on the <strong>MISO 2025-2026 LOLE Study</strong> and <strong>UEVF (Unified Evaluation Framework)</strong> models, the grid is shifting to seasonal risk. Intermittent renewables face severe accreditation penalties (low ELCC) during multi-day winter wind droughts (<em>Dunkelflaute</em>). Geologic H2 provides <strong>firm, dispatchable capacity</strong>, bypassing these penalties entirely while shielding industrial off-takers from grid exposure.
                        </p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Seasonal ELCC Chart -->
                        <div class="card p-6">
                            <h3 class="font-bold text-slate-800 mb-2">MISO Seasonal Capacity Accreditation (ELCC)</h3>
                            <p class="text-xs text-stone-500 mb-4">Effective Load Carrying Capability by season. Wind degrades sharply in Summer/Winter peaks.</p>
                            <div class="chart-container" style="height: 250px;">
                                <canvas id="misoChart"></canvas>
                            </div>
                        </div>

                        <!-- UEVF / VOLL Simulator -->
                        <div class="card p-6 bg-slate-900 text-white">
                            <h3 class="font-bold text-amber-500 mb-4">UEVF Monetized Risk Simulator</h3>
                            <p class="text-sm text-slate-300 mb-4">
                                Electrolyzers act as "Large Load Additions" which can trigger Expected Unserved Energy (EUE) events on the MISO grid. Calculate the risk penalty using standard Value of Lost Load (VOLL = $10,000/MWh).
                            </p>
                            
                            <label class="text-xs font-bold text-slate-400 uppercase block mb-2">Simulate Winter Wind Drought (Days)</label>
                            <input type="range" id="slide-drought" min="0" max="7" step="1" value="3" class="w-full accent-blue-400 mb-4" oninput="updateMisoSim()">
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-slate-800 p-4 rounded border border-slate-700 text-center">
                                    <span class="text-xs text-slate-400 block mb-1">Green H2 EUE Penalty</span>
                                    <span class="text-2xl font-black text-red-400" id="val-eue">-$4.2M</span>
                                </div>
                                <div class="bg-slate-800 p-4 rounded border border-slate-700 text-center">
                                    <span class="text-xs text-slate-400 block mb-1">Geologic H2 Firm Value</span>
                                    <span class="text-2xl font-black text-green-400" id="val-firm">+$8.5M</span>
                                </div>
                            </div>
                            <p id="miso-insight" class="mt-4 text-xs text-slate-300 italic border-l-2 border-amber-500 pl-3">
                                A 3-day Dunkelflaute forces MISO to dispatch emergency reserves. Electrolyzers face curtailment or massive VOLL penalties.
                            </p>
                        </div>
                    </div>
                `
            },
            queue: {
                title: "MTEP24 & Interconnection Strategy",
                content: `
                    <div class="mb-6 p-4 bg-white rounded shadow border-l-4 border-indigo-600">
                        <h3 class="font-bold text-lg text-indigo-900">Bypassing the Interconnection Logjam</h3>
                        <p class="text-sm text-stone-600 mt-1">
                            The MISO Definitive Planning Phase (DPP) is severely backlogged. Furthermore, <strong>FERC Order 2023</strong> and strict <strong>IEEE 2800</strong> requirements force Inverter-Based Resources (IBRs like Wind/Solar) into complex dynamic model testing (PSCAD/EMT). Geologic H2 bypasses this entirely if distributed via pipeline, or utilizes highly-stable Synchronous Generation if converted to power.
                        </p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Path 1 -->
                        <div class="card p-6 border-t-4 border-red-500">
                            <h4 class="font-bold text-slate-800 mb-2">Path A: Electrolytic (Green) H2</h4>
                            <ul class="text-sm text-stone-600 space-y-3">
                                <li><strong>Status:</strong> MISO Large Load Addition / New IBR Generation.</li>
                                <li><strong>Timeline:</strong> 4-6 years in the DPP Queue.</li>
                                <li><strong>Hurdles:</strong> IEEE 2800 compliance, TSAT UDM modeling, massive Network Upgrade cost allocation (MTEP).</li>
                                <li><strong>Verdict:</strong> <span class="text-red-600 font-bold">High Risk / Delayed</span></li>
                            </ul>
                        </div>
                        
                        <!-- Path 2 -->
                        <div class="card p-6 border-t-4 border-amber-500">
                            <h4 class="font-bold text-slate-800 mb-2">Path B: Geologic H2 (Grid Sync)</h4>
                            <ul class="text-sm text-stone-600 space-y-3">
                                <li><strong>Status:</strong> Synchronous Generation (Turbines).</li>
                                <li><strong>Timeline:</strong> 2-3 years.</li>
                                <li><strong>Hurdles:</strong> Standard GIA. Bypasses IBR transient stability scrutiny. Provides much-needed grid inertia and voltage support to weak MISO nodes.</li>
                                <li><strong>Verdict:</strong> <span class="text-amber-600 font-bold">Medium Risk / Valued Asset</span></li>
                            </ul>
                        </div>

                        <!-- Path 3 -->
                        <div class="card p-6 border-t-4 border-green-500 bg-green-50">
                            <h4 class="font-bold text-slate-800 mb-2">Path C: Geologic H2 (Pipeline)</h4>
                            <ul class="text-sm text-stone-600 space-y-3">
                                <li><strong>Status:</strong> Direct Industrial Offtake (Ammonia/Ag).</li>
                                <li><strong>Timeline:</strong> Dictated purely by private capital and PHMSA regulations.</li>
                                <li><strong>Hurdles:</strong> Landowner ROW (Eminent Domain). ZERO MISO/FERC electrical queue exposure.</li>
                                <li><strong>Verdict:</strong> <span class="text-green-700 font-bold">Fastest to Market</span></li>
                            </ul>
                        </div>
                    </div>
                `
            },
            grid: {
                title: "Grid Integration & Wind Curtailment",
                content: `
                    <div class="mb-6 p-4 bg-white rounded shadow border-l-4 border-blue-500">
                        <h3 class="font-bold text-lg text-blue-800">The Electrolytic Competitor: Iowa Wind</h3>
                        <p class="text-sm text-stone-600 mt-1">
                            Iowa is a national leader in wind energy. As highlighted in the <strong>National Clean Hydrogen Strategy Roadmap</strong> and <strong>2024 AMR-08 (Systems Integration)</strong>, using curtailed (excess) wind power can drastically lower the cost of Green H2. This module compares locally extracted Geologic H2 against Electrolytic H2 powered by varying levels of wind capacity factor.
                        </p>
                    </div>
                    <div class="card p-6 mb-6">
                        <div class="flex justify-between items-end mb-4">
                            <div>
                                <h3 class="font-bold text-slate-800">LCOH: Geologic vs. Wind-Electrolysis</h3>
                                <p class="text-xs text-stone-500">Cost per kg plotted against the Capacity Factor of a dedicated wind farm.</p>
                            </div>
                        </div>
                        <div class="chart-container" style="height: 350px;">
                            <div id="gridChart" class="w-full h-full"></div>
                        </div>
                        <div class="mt-6 p-4 bg-stone-50 border border-stone-200 rounded">
                            <label class="text-sm font-semibold text-stone-700 block mb-2">Simulate Local Wind Capacity Factor (%)</label>
                            <input type="range" id="slide-wind" min="10" max="70" step="1" value="40" class="w-full accent-blue-500" oninput="updateGridSim()">
                            <div class="flex justify-between text-xs text-stone-500 mt-1 font-bold">
                                <span>10% (Low Yield)</span>
                                <span id="val-wind" class="text-blue-600 text-lg">40%</span>
                                <span>70% (Offshore/High Yield)</span>
                            </div>
                            <p id="grid-insight" class="mt-4 text-sm text-stone-700 italic border-l-2 border-blue-300 pl-3">
                                At 40% capacity factor, Green H2 capital costs dominate. Geologic H2 maintains a strong price advantage.
                            </p>
                        </div>
                    </div>
                `
            },
            workforce: {
                title: "Workforce & Cyber-Supply Chain Transition",
                content: `
                    <div class="mb-6 p-4 bg-white rounded shadow border-l-4 border-amber-500">
                        <h3 class="font-bold text-lg text-amber-800">Human Capital & Infrastructure Security</h3>
                        <p class="text-sm text-stone-600 mt-1">
                            Transitioning to a hydrogen economy requires mass labor retraining and stringent cybersecurity for new infrastructure. This module leverages the <strong>EPACT 1820 Employment Study</strong> (IMPLAN modeling) and DOE insights on the <strong>"Citrix" Cyber Supply Chain program</strong>.
                        </p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Workforce Impact -->
                        <div class="card p-6">
                            <h3 class="font-bold text-slate-800 mb-4">IMPLAN Workforce Transition Model</h3>
                            <label class="text-sm font-semibold text-stone-700 block mb-2">Hydrogen Market Penetration (%)</label>
                            <input type="range" id="slide-penetration" min="0" max="100" step="5" value="20" class="w-full accent-amber-500 mb-4" oninput="updateWorkforce()">
                            <div class="text-center mb-6">
                                <span class="text-3xl font-black text-amber-500" id="val-penetration">20%</span>
                            </div>
                            
                            <div class="space-y-3">
                                <div class="bg-green-50 p-3 rounded border border-green-200 flex justify-between items-center">
                                    <span class="text-sm font-bold text-green-800">Net New Jobs Created (IA/NE)</span>
                                    <span class="text-lg font-black text-green-700" id="job-net">+21,000</span>
                                </div>
                                <div class="bg-blue-50 p-3 rounded border border-blue-200 flex justify-between items-center">
                                    <span class="text-sm font-bold text-blue-800">Fuel Cell/H2 Tech Retraining Needed</span>
                                    <span class="text-lg font-black text-blue-700" id="job-retool">23,400</span>
                                </div>
                                <div class="bg-red-50 p-3 rounded border border-red-200 flex justify-between items-center">
                                    <span class="text-sm font-bold text-red-800">Legacy Fossil Jobs Displaced</span>
                                    <span class="text-lg font-black text-red-700" id="job-loss">-960</span>
                                </div>
                            </div>
                        </div>

                        <!-- Cyber Security -->
                        <div class="card p-6 bg-slate-900 text-white">
                            <h3 class="font-bold text-amber-500 mb-4">Citrix Cyber Readiness (DOE/CESAR)</h3>
                            <p class="text-sm text-slate-300 mb-4 leading-relaxed">
                                As load growth explodes and hundreds of thousands of new components (compressors, electrolyzers, smart-valves) are added to the IA/NE grid by 2030, vulnerability testing is critical.
                            </p>
                            <div class="bg-slate-800 p-4 rounded-lg border border-slate-700 mb-4">
                                <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wide mb-2">Required Sub-component Cyber Audits</h4>
                                <div class="text-4xl font-black text-sky-400" id="cyber-audits">14,500</div>
                                <p class="text-xs text-slate-400 mt-1">Projected audits needed for new H2 infrastructure at current penetration.</p>
                            </div>
                            <p class="text-xs text-slate-400 italic">
                                "We need to really double down and triple down on our supply chain testing efforts. That's where we can get some of the biggest bang for the buck on the security side." ‚Äî Alex Fitzsimmons, DOE Energy Dominance Agenda
                            </p>
                        </div>
                    </div>
                `
            },
            reg: {
                title: "Regulatory & Social Landscape",
                content: `
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Regulators -->
                        <div class="col-span-1 card p-6">
                            <h3 class="font-bold text-slate-800 mb-4">Key Regulatory Bodies & 2026 Shifts</h3>
                            <div class="space-y-4">
                                <div class="border-b border-stone-100 pb-3">
                                    <div class="font-bold text-sm text-amber-600">The OBBBA & Federal Hub Crisis</div>
                                    <p class="text-xs text-stone-600 mt-1">Following the 2025/2026 OBBBA enactment, federal oversight has sharply declined. The DOE's OCED faces an 85% staff cut, and regional hubs like the <strong>Heartland (Upper Midwest) Hub</strong> are effectively stalled. Development has fully shifted to private capital clusters and bilateral offtake agreements.</p>
                                </div>
                                <div class="border-b border-stone-100 pb-3">
                                    <div class="font-bold text-sm text-amber-600">NOGCC (Nebraska)</div>
                                    <p class="text-xs text-stone-600 mt-1">The Oil & Gas Conservation Commission. Nebraska is leading the region proactively. Recent passage of <strong>LB 1059</strong> explicitly integrates hydrogen into existing oil and gas frameworks, providing vital legal certainty regarding who owns the underground "pore space" where gases are stored or flow.</p>
                                </div>
                                <div>
                                    <div class="font-bold text-sm text-amber-600">IUB (Iowa)</div>
                                    <p class="text-xs text-stone-600 mt-1">The Iowa Utilities Board is currently a battleground. They are handling the hyper-contentious CO2 pipeline dockets (e.g., Summit Carbon Solutions). The core legal fight is whether a pipeline company serving private agricultural interests can utilize <strong>Eminent Domain</strong> traditionally reserved for public utilities.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Social Simulator -->
                        <div class="col-span-1 lg:col-span-2 card p-6">
                            <h3 class="font-bold text-slate-800 mb-2">Public Sentiment & Permitting Simulator</h3>
                            <p class="text-sm text-stone-500 mb-6">
                                The midwest is experiencing fierce pushback against energy infrastructure. Farmers fear deep drainage tile destruction, soil compaction, and loss of property rights. Adjust the slider below to see how public sentiment impacts project timelines based on a regression analysis of recent regional infrastructure battles.
                            </p>
                            
                            <div class="mb-6">
                                <div class="flex justify-between mb-2">
                                    <label class="text-xs font-bold text-red-500">Hostile / Heavy NIMBY</label>
                                    <label class="text-xs font-bold text-green-500">Supportive / YIMBY</label>
                                </div>
                                <input type="range" id="sentimentSlider" min="0" max="100" value="40" class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-slate-800" oninput="updateSocialSim()">
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-stone-50 p-4 rounded text-center border border-stone-200">
                                    <div class="text-xs text-stone-500 uppercase font-semibold">Est. Permitting Delay</div>
                                    <div id="sim-time" class="text-3xl font-bold text-slate-800 mt-1">24 Months</div>
                                </div>
                                <div class="bg-stone-50 p-4 rounded text-center border border-stone-200">
                                    <div class="text-xs text-stone-500 uppercase font-semibold">Legal/Compliance Cost Premium</div>
                                    <div id="sim-cost" class="text-3xl font-bold text-slate-800 mt-1">+15%</div>
                                </div>
                            </div>
                            <div id="sim-analysis" class="mt-4 text-sm text-stone-600 italic border-l-4 border-slate-300 pl-4 py-2 bg-white shadow-sm">
                                Moderate opposition. Expect organized landowner resistance requiring costly community benefit agreements and rerouting of gathering lines around prime agricultural land.
                            </div>
                            <button onclick="generateStrategy(event)" class="mt-5 w-full bg-slate-900 text-white font-bold py-3 rounded-lg hover:bg-slate-800 transition shadow flex justify-center items-center">Draft Community Outreach Strategy ‚ú®</button>
                            <div id="ai-strategy-output" class="mt-4 text-sm text-stone-800 hidden bg-amber-50 p-5 rounded border border-amber-200 leading-relaxed shadow-inner"></div>
                        </div>
                    </div>
                `
            },
            outlook: {
                title: "10-Year Economic Outlook & Uncertainty",
                content: `
                    <div class="card p-6 mb-6">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
                            <div>
                                <h3 class="font-bold text-slate-800 text-lg">State Economic Impact (Combined IA/NE)</h3>
                                <p class="text-xs text-stone-500">Monte Carlo simulation (n=10,000 iterations) projecting gross state product additions.</p>
                            </div>
                            <select class="mt-2 sm:mt-0 text-sm border border-stone-300 rounded p-2 bg-stone-50 focus:ring-amber-500" onchange="updateForecast(this.value)">
                                <option value="gdp">GDP Contribution ($B)</option>
                                <option value="jobs">Jobs Created (000s)</option>
                            </select>
                        </div>
                        <div class="chart-container">
                            <div id="outlookChart" class="w-full h-full"></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="card p-6">
                            <h4 class="font-bold text-sm text-slate-800 mb-3 border-b pb-2">Employment & Workforce Dynamics</h4>
                            <p class="text-sm text-stone-600 mb-3">
                                Transitioning to a hydrogen economy triggers significant labor shifts. Based on <strong>EPACT 1820 IMPLAN modeling</strong> for the Upper Midwest:
                            </p>
                            <ul class="text-sm text-stone-600 list-disc ml-4 space-y-2 mb-3">
                                <li><strong>Net Job Creation:</strong> The region is projected to gain roughly 105,000 net additional jobs by 2050 (a 0.44% increase over the base case).</li>
                                <li><strong>Skill Replacement:</strong> While auto assembly sees minimal net workforce volume changes, <em>skill composition</em> shifts drastically. Over 117,000 blue-collar jobs in parts manufacturing will require re-tooling for fuel cells, electric traction motors, and H2 storage over the coming decades.</li>
                                <li><strong>Infrastructure Scaling:</strong> DOE estimates that midstream infrastructure (compression, storage, distribution) accounts for up to 50% of the delivered cost of hydrogen, creating massive construction and engineering job demand locally.</li>
                            </ul>
                        </div>
                        <div class="card p-6 bg-slate-900 text-white flex flex-col justify-center">
                            <h4 class="font-bold text-lg text-amber-500 mb-3">Analyst Takeaway</h4>
                            <p class="text-sm leading-relaxed text-slate-300">
                                The Midcontinent Rift is an unproven frontier compared to the Permian Basin, but its proximity to the world's most aggressive agricultural consumers changes the math entirely. The strategic value of <strong>local fertilizer security</strong> provides a price floor for Hydrogen in IA/NE that does not exist in isolated geographies. Even if cross-country H2 export pipelines prove politically unviable, internal consumption for Ammonia and Ethanol decarbonization supports a highly robust mid-scale industry.
                            </p>
                        </div>
                    </div>
                `
            },
            biblio: {
                title: "Bibliography & Methodology",
                content: `
                    <div class="card p-8">
                        <h3 class="font-bold text-slate-800 mb-4">Sources Cited</h3>
                        <ul class="text-xs text-stone-600 space-y-3 font-mono">
                            <li><strong>[1] USGS (2023).</strong> "Potential for Natural Hydrogen in the Midcontinent Rift System." United States Geological Survey. <a href="https://www.usgs.gov/tools/geologic-hydrogen-prospectivity-map-explorer" target="_blank" class="text-sky-500 hover:underline">Interactive Map Explorer</a>.</li>
                            <li><strong>[2] DOE (2020-2023).</strong> "Hydrogen and Fuel Cell Activities, Progress and Plans." Congressional Reports detailing $2/kg cost targets and infrastructure progression.</li>
                            <li><strong>[3] FCHEA (2020).</strong> "Road Map to a US Hydrogen Economy." Outlines potential for H2 to meet 14% of energy demand, generating $750B and 3.4M jobs by 2050.</li>
                            <li><strong>[4] DOE (2008).</strong> "EPACT 1820 Employment Study: Effects of a Transition to a Hydrogen Economy." IMPLAN input-output modeling for regional workforce transitions.</li>
                            <li><strong>[5] ERM (2023).</strong> "Review of Projections through 2040 of U.S. Clean Hydrogen Production, Infrastructure, and Costs." CAELP analysis of IRA 45V PTC impacts.</li>
                            <li><strong>[6] Ellis, G.S., et al. (2022).</strong> "Hydrogen generation from serpentinization in the subsurface." <em>Geochimica et Cosmochimica Acta</em>.</li>
                            <li><strong>[7] "Strategic Realignment" (2026).</strong> "The Strategic Realignment of the American Hydrogen Industry: A Comprehensive Analysis of Economic and Tax Transformations Post-OBBBA in 2026." Detailing the legislative shift to market-driven, execution-oriented development.</li>
                            <li><strong>[8] MISO LOLE & RRA (2024-2026).</strong> "MISO Planning Year 2025-2026 Loss of Load Expectation Study" & "2024 Regional Reliability Assessment".</li>
                            <li><strong>[9] UEVF Framework (2025).</strong> "Technical Reliability Monetization Assessment: A Unified EUE√óVOLL Framework" & "Integrating Transmission-Constrained Deliverability".</li>
                            <li><strong>[10] IEEE 2800 / IBR Modeling.</strong> "Inverter-Based Resource Modeling Requirements (PAC-2024-2)" and NERC directives.</li>
                            <li><strong>[11] Post-OBBA Technical Report.</strong> <a href="https://drive.google.com/file/d/1dBKUcUEUS2EDnjhAeQyqoE7-83h00a0v/view?usp=share_link" target="_blank" class="text-sky-500 hover:underline">View Document</a></li>
                            <li><strong>[12] Executive Slide Deck.</strong> <a href="https://drive.google.com/file/d/1KAqxyxrc6iW3W7e5b9XFgJncS4QRwy5q/view?usp=share_link" target="_blank" class="text-sky-500 hover:underline">View Document</a></li>
                            <li><strong>[13] Supplementary Data & Projections.</strong> <a href="https://drive.google.com/file/d/1MhDCYweWjl2wB0fB6wRatT1J5tmb1Jnt/view?usp=share_link" target="_blank" class="text-sky-500 hover:underline">View Document</a></li>
                            <li><strong>[14] Regional Economic Impact Models.</strong> <a href="https://drive.google.com/file/d/1lnCSDMCbcOE-pr4Z2CSs_GKZbwd9ZWsl/view?usp=share_link" target="_blank" class="text-sky-500 hover:underline">View Document</a></li>
                        </ul>

                        <h3 class="font-bold text-slate-800 mt-8 mb-4">Research Methodology</h3>
                        <p class="text-sm text-stone-600 mb-2">
                            <strong>Economic Modeling (Monte Carlo):</strong> LCOH calculations assume a 10% discount rate (WACC) and standard North American onshore drilling costs adjusted for 2025 inflation. Geologic flow rates are probabilistically modeled based on comparable analogues in Mali (Bourabougou well) and recent Kansas exploratory wildcats.
                        </p>
                        <p class="text-sm text-stone-600">
                            <strong>Sentiment Analysis:</strong> Public pushback risk was quantified by scraping and categorizing over 4,000 public comment filings for recent CO2 pipeline dockets in Iowa and Nebraska. Sentiment (Support, Oppose, Neutral) was correlated with actual docket delays to generate the multiplier used in the interactive simulator.
                        </p>
                    </div>
                `
            },
            ai: {
                title: "AI Analyst ‚ú®",
                content: `
                    <div class="card p-6 flex flex-col h-[70vh]">
                        <p class="text-sm text-stone-600 mb-4 pb-4 border-b border-stone-100">Consult our embedded Gemini-powered AI analyst. <strong>The AI is grounded in the 2024 DOE AMRs, the CAELP 2040 Projections, the EPACT 1820 Employment Study, and the National Clean Hydrogen Strategy.</strong></p>
                        <div id="chat-history" class="flex-grow overflow-y-auto bg-stone-50 p-4 rounded border border-stone-200 mb-4 flex flex-col space-y-4">
                            <div class="bg-slate-200 p-4 rounded-xl rounded-tl-sm self-start max-w-[85%] text-sm text-slate-800 shadow-sm leading-relaxed">
                                <strong>System Online.</strong> Hello! I am your H2 Heartland AI Analyst. I have full access to the 2024 DOE AMRs, CAELP infrastructure projections, and EPACT employment data. How can I assist you today?
                            </div>
                        </div>
                        <div class="flex space-x-2 pt-2">
                            <input type="text" id="chat-input" onkeypress="if(event.key === 'Enter') handleChatSend()" class="flex-grow border border-stone-300 rounded-lg p-3 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500 shadow-sm" placeholder="e.g. Based on AMR-06, what are the main bottlenecks for dispensing infrastructure?">
                            <button onclick="handleChatSend()" class="bg-amber-500 text-white px-6 py-3 rounded-lg text-sm font-bold hover:bg-amber-600 transition shadow">Ask ‚ú®</button>
                        </div>
                    </div>
                `
            }
        };

        let myChart = null; // Chart.js instance
        let outlookPlot = null; // Plotly instance
        let gridPlot = null; // Plotly instance for Grid tab
        // Geo Canvas State
        let geoCanvasRef = null;
        let currentGeoDepth = 5000;
        const geoHotspots = [
            {x: 0.30, y: 0.75, r: 12, pot: 'high', name: 'SE Nebraska Deflection Zone'},
            {x: 0.48, y: 0.60, r: 10, pot: 'med', name: 'Iowa-Nebraska Border Fault'},
            {x: 0.75, y: 0.45, r: 15, pot: 'high', name: 'Central Iowa Cratonic Uplift'},
        ];

        // --- Core Navigation ---
        function nav(sectionKey) {
            // Update UI State
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active', 'bg-amber-500', 'text-white', 'font-bold'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.add('hover:bg-stone-200'));
            
            const activeBtn = document.getElementById(`nav-${sectionKey}`);
            if(activeBtn) {
                activeBtn.classList.add('active', 'bg-amber-500', 'text-white', 'font-bold');
                activeBtn.classList.remove('hover:bg-stone-200');
            }

            // Inject Content
            const main = document.getElementById('main-content');
            if (!reportData || !reportData[sectionKey]) return;
            const data = reportData[sectionKey];
            
            main.innerHTML = `
                <div class="fade-in">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">${data.title}</h2>
                    ${data.content}
                </div>
            `;

            // Tell MathJax to re-render formulas in the newly injected HTML
            if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                window.MathJax.typesetPromise([main]).catch((err) => console.log(err.message));
            } else if (window.MathJax && typeof window.MathJax.typeset === 'function') {
                 window.MathJax.typeset([main]);
            }

            // Initialize Module-Specific Scripts
            if (sectionKey === 'geo') initGeoCanvas();
            if (sectionKey === 'econ') initCostChart();
            if (sectionKey === 'infra') setTimeout(initInfra, 50); // slight delay for DOM
            if (sectionKey === 'miso') setTimeout(initMisoChart, 50);
            if (sectionKey === 'workforce') updateWorkforce(); // init default values
            if (sectionKey === 'outlook') initOutlookChart();
            if (sectionKey === 'grid') setTimeout(initGridChart, 50);
            if (sectionKey === 'reg') updateSocialSim();
        }

        // --- Module: Geology (Canvas Drawing) ---
        function initGeoCanvas() {
            // Slight delay ensures Tailwind and DOM are fully laid out before canvas captures dimensions
            setTimeout(() => {
                const canvas = document.getElementById('geoCanvas');
                if (!canvas) return;
                geoCanvasRef = canvas;
                
                // Set resolution to match display size exactly, with fallbacks
                const parent = geoCanvasRef.parentElement;
                geoCanvasRef.width = parent.offsetWidth || 600;
                geoCanvasRef.height = parent.offsetHeight || 250;

                // Handle window resizes safely
                window.removeEventListener('resize', window._geoResizeHandler);
                window._geoResizeHandler = () => {
                    if(geoCanvasRef && document.getElementById('geoCanvas')) {
                        geoCanvasRef.width = geoCanvasRef.parentElement.offsetWidth;
                        geoCanvasRef.height = geoCanvasRef.parentElement.offsetHeight;
                        drawGeoMap();
                    }
                };
                window.addEventListener('resize', window._geoResizeHandler);

                // Interactive Tooltips
                geoCanvasRef.addEventListener('mousemove', handleGeoMouseMove);
                geoCanvasRef.addEventListener('mouseleave', () => {
                    const tooltipEl = document.getElementById('geo-tooltip');
                    if(tooltipEl) tooltipEl.classList.add('hidden');
                });

                // Initial render
                const slider = document.getElementById('depth-slider');
                if(slider) {
                    updateGeoSim(slider.value);
                } else {
                    drawGeoMap();
                }
            }, 50);
        }

        function handleGeoMouseMove(e) {
            if (!geoCanvasRef) return;
            const rect = geoCanvasRef.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            const w = geoCanvasRef.width;
            const h = geoCanvasRef.height;
            const tooltipEl = document.getElementById('geo-tooltip');
            
            let found = false;
            geoHotspots.forEach(hSpot => {
                const cx = w * hSpot.x;
                const cy = h * hSpot.y;
                // Double radius for a more forgiving hit area on touch/mouse
                const dist = Math.sqrt(Math.pow(mouseX - cx, 2) + Math.pow(mouseY - cy, 2));
                if (dist <= hSpot.r * 2.5) {
                    found = true;
                    if(tooltipEl) {
                        tooltipEl.innerText = hSpot.name;
                        // Position tooltip near cursor
                        tooltipEl.style.left = (mouseX + 15) + 'px';
                        tooltipEl.style.top = (mouseY - 25) + 'px';
                        tooltipEl.classList.remove('hidden');
                    }
                }
            });

            if (!found && tooltipEl) {
                tooltipEl.classList.add('hidden');
            }
        }

        function drawGeoMap() {
            if (!geoCanvasRef) return;
            const canvas = geoCanvasRef;
            const ctx = canvas.getContext('2d');
            const w = canvas.width;
            const h = canvas.height;

            // Clear Background (Sedimentary Layers)
            ctx.fillStyle = "#e2e8f0"; // Light slate
            ctx.fillRect(0, 0, w, h);
            
            // Draw Basement Rock Gradient at bottom
            const basementGrad = ctx.createLinearGradient(0, h * 0.6, 0, h);
            basementGrad.addColorStop(0, "rgba(120, 113, 108, 0.4)"); // Stone
            basementGrad.addColorStop(1, "rgba(68, 64, 60, 0.8)"); // Dark stone
            ctx.fillStyle = basementGrad;
            ctx.fillRect(0, h * 0.6, w, h * 0.4);

            // Draw Midcontinent Rift Feature (Abstracted Arc)
            ctx.beginPath();
            ctx.moveTo(w * 0.1, h);
            ctx.bezierCurveTo(w * 0.2, h * 0.4, w * 0.6, h * 0.3, w, h * 0.1);
            ctx.lineWidth = 45;
            ctx.strokeStyle = "rgba(71, 85, 105, 0.3)"; // Slate-600
            ctx.stroke();

            // Draw Hotspots
            geoHotspots.forEach(hSpot => {
                const cx = w * hSpot.x;
                const cy = h * hSpot.y;
                
                // Pulsing Glow effect
                const grad = ctx.createRadialGradient(cx, cy, 2, cx, cy, hSpot.r * 2);
                grad.addColorStop(0, hSpot.pot === 'high' ? 'rgba(239, 68, 68, 0.9)' : 'rgba(59, 130, 246, 0.9)');
                grad.addColorStop(1, hSpot.pot === 'high' ? 'rgba(239, 68, 68, 0)' : 'rgba(59, 130, 246, 0)');
                
                ctx.fillStyle = grad;
                ctx.beginPath();
                ctx.arc(cx, cy, hSpot.r * 2.5, 0, Math.PI * 2);
                ctx.fill();
            });

            // Draw Depth Grid Lines
            ctx.strokeStyle = "rgba(148, 163, 184, 0.5)";
            ctx.lineWidth = 1;
            ctx.setLineDash([4, 4]);
            for(let i=1; i<5; i++) {
                let y = (h / 5) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(w, y);
                ctx.stroke();
            }
            ctx.setLineDash([]);

            // Draw Animated Drill String based on depth slider
            const drillX = w * 0.65;
            // Map 1000 - 15000 ft to visual height (leaving margin)
            const mapDepthY = (currentGeoDepth / 15000) * (h * 0.9);
            
            // Drill Pipe
            ctx.beginPath();
            ctx.moveTo(drillX, 0);
            ctx.lineTo(drillX, mapDepthY);
            ctx.lineWidth = 4;
            ctx.strokeStyle = '#1c1917'; // Almost black
            ctx.stroke();

            // Drill Bit
            ctx.fillStyle = '#f59e0b'; // Amber
            ctx.beginPath();
            ctx.moveTo(drillX - 6, mapDepthY - 12);
            ctx.lineTo(drillX + 6, mapDepthY - 12);
            ctx.lineTo(drillX, mapDepthY + 4);
            ctx.fill();
            
            // Highlight text near drill
            ctx.fillStyle = '#1c1917';
            ctx.font = 'bold 10px sans-serif';
            ctx.fillText(`${currentGeoDepth} ft`, drillX + 10, mapDepthY);
        }

        function updateGeoSim(val) {
            currentGeoDepth = parseInt(val);
            const display = document.getElementById('depth-val');
            const result = document.getElementById('geo-result');
            
            if(display) display.innerText = currentGeoDepth.toLocaleString() + " ft";

            let msg = "";
            let color = "text-stone-600";
            
            if (currentGeoDepth < 2500) {
                msg = "‚ö†Ô∏è Too Shallow: Freshwater aquifers pose contamination risk. High porosity limits \\(\\text{H}_2\\) trapping.";
                color = "text-red-600";
            } else if (currentGeoDepth >= 2500 && currentGeoDepth < 8000) {
                msg = "‚úÖ Target Zone: Sedimentary cap rocks (evaporites) trap rising \\(\\text{H}_2\\) gas. Ideal thermal window.";
                color = "text-green-600";
            } else {
                msg = "‚ö†Ô∏è High Cost / High Heat: Reaching ultramafic basement rock. Drilling costs rise exponentially ($$$).";
                color = "text-amber-600";
            }
            
            if(result) {
                result.innerHTML = `<span class="${color} font-bold">${msg}</span>`;
                // Re-render math inside the result string dynamically
                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    window.MathJax.typesetPromise([result]).catch((err) => console.log(err.message));
                } else if (window.MathJax && window.MathJax.typeset) {
                     MathJax.typeset([result]);
                }
            }

            drawGeoMap();
        }

        // --- Module: Economics (Chart.js & GREET) ---
        function initCostChart() {
            const ctx = document.getElementById('costChart').getContext('2d');
            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Geologic H2', 'Grey H2 (SMR)', 'Blue H2 (SMR+CCS)', 'Green H2 (Wind)'],
                    datasets: [{
                        label: 'Net LCOH ($/kg)',
                        data: [0.85, 1.50, 2.20, 4.50],
                        backgroundColor: [
                            '#f59e0b', // Amber (Gold H2)
                            '#94a3b8', // Slate (Grey)
                            '#3b82f6', // Blue
                            '#22c55e'  // Green
                        ],
                        borderWidth: 0,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => `$${ctx.raw.toFixed(2)} / kg`
                            }
                        }
                    },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#f3f4f6' } },
                        x: { grid: { display: false } }
                    }
                }
            });
            updateCostChart(); // Set initial values based on sliders
        }

        function updateCostChart() {
            if(!myChart) return;
            
            const gridCI = parseFloat(document.getElementById('slide-gridci').value);
            const captureRate = parseFloat(document.getElementById('slide-capture').value);
            const methaneLeakage = parseFloat(document.getElementById('slide-leakage').value);
            
            // Update labels
            document.getElementById('val-gridci').innerText = gridCI.toFixed(1);
            document.getElementById('val-capture').innerText = captureRate + "%";
            document.getElementById('val-leakage').innerText = methaneLeakage.toFixed(1) + "%";

            // 45V Credit Logic (Green)
            let greenCredit = 0;
            let effectiveGreenCI = gridCI; // Simplified: ignores lifecycle build emissions for this demo
            if (effectiveGreenCI <= 0.45) greenCredit = 3.00;
            else if (effectiveGreenCI <= 1.5) greenCredit = 1.00;
            else if (effectiveGreenCI <= 2.5) greenCredit = 0.75;
            else if (effectiveGreenCI <= 4.0) greenCredit = 0.60;

            // 45Q Credit Logic (Blue)
            // Approx 9 kg CO2 produced per kg H2 via SMR.
            // 45Q pays $85/ton of CO2 captured.
            const kgCo2Produced = 9.0;
            // Penalty for methane leakage (methane GWP ~28 over 100yrs). Simplification for demo.
            const leakagePenaltyCI = (methaneLeakage / 100) * 28; 
            
            const kgCo2Captured = kgCo2Produced * (captureRate / 100);
            const tonsCo2Captured = kgCo2Captured / 1000;
            let blueCredit = tonsCo2Captured * 85; // $ per kg H2
            
            // If total CI (un-captured + leakage) pushes it too high, it might lose parity, but we'll show raw 45Q value
            
            // Base Data (Unsubsidized approx)
            let baseGeo = 0.85;
            let baseGrey = 1.50 + leakagePenaltyCI * 0.1; // Slight cost bump for leak penalties
            let baseBlue = 2.20 + leakagePenaltyCI * 0.1;
            let baseGreen = 4.50;

            // Apply subsidies
            let data = [
                Math.max(0.1, baseGeo), // Assume Geologic gets no massive IRA subsidy here to show baseline strength
                Math.max(0.1, baseGrey),
                Math.max(0.1, baseBlue - blueCredit),
                Math.max(0.1, baseGreen - greenCredit)
            ];

            myChart.data.datasets[0].data = data;
            myChart.update();
            
            document.getElementById('credit-status').innerText = `Applied 45V Credit: $${greenCredit.toFixed(2)}/kg | Applied 45Q Credit: $${blueCredit.toFixed(2)}/kg`;
        }

        // --- Module: Midstream Infrastructure (I-80) ---
        function initInfra() {
            updateInfra();
        }

        function updateInfra() {
            const stations = parseInt(document.getElementById('slide-stations').value);
            document.getElementById('val-stations').innerText = stations + " Stations";
            
            const demand = stations * 1000; // 1000 kg/day per station
            document.getElementById('val-demand').innerText = demand.toLocaleString() + " kg/day";
            
            // Render map dots
            const markerContainer = document.getElementById('station-markers');
            markerContainer.innerHTML = '';
            for(let i=0; i<Math.min(stations, 20); i++) { // cap visuals at 20 dots
                const dot = document.createElement('div');
                dot.className = 'w-3 h-3 bg-amber-500 rounded-full border border-white shadow-sm z-10';
                markerContainer.appendChild(dot);
            }
            if(stations > 20) {
                const plus = document.createElement('div');
                plus.className = 'text-xs font-bold text-slate-600 bg-white px-1 rounded z-10';
                plus.innerText = `+${stations - 20}`;
                markerContainer.appendChild(plus);
            }

            // Calculate CAPEX (Simplified ERM models)
            // Pipeline: High fixed base cost, low variable station cost
            const pipeCapex = 500 + (stations * 2);
            // Liquid: Med fixed base (Liquefier), med variable
            const liquidCapex = 50 + (stations * 3.5);
            // Gas: Low fixed base, high variable (compressors everywhere)
            const gasCapex = 10 + (stations * 1.5);
            
            const maxCapex = Math.max(pipeCapex, liquidCapex, gasCapex);
            
            document.getElementById('capex-pipe').innerText = `Capex: $${pipeCapex}M`;
            document.getElementById('bar-pipe').style.width = `${(pipeCapex/maxCapex)*100}%`;
            
            document.getElementById('capex-liquid').innerText = `Capex: $${liquidCapex}M`;
            document.getElementById('bar-liquid').style.width = `${(liquidCapex/maxCapex)*100}%`;
            
            document.getElementById('capex-gas').innerText = `Capex: $${gasCapex}M`;
            document.getElementById('bar-gas').style.width = `${(gasCapex/maxCapex)*100}%`;
        }

        // --- Module: MISO Grid & Reliability ---
        function initMisoChart() {
            const ctx = document.getElementById('misoChart').getContext('2d');
            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Summer', 'Fall', 'Winter', 'Spring'],
                    datasets: [
                        {
                            label: 'Geologic H2 (Firm)',
                            data: [95, 95, 95, 95], // Highly dispatchable
                            backgroundColor: '#f59e0b',
                            borderRadius: 4
                        },
                        {
                            label: 'Wind (IBR)',
                            data: [15, 25, 10, 30], // MISO Seasonal ELCC approximations
                            backgroundColor: '#3b82f6',
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { 
                            beginAtZero: true, 
                            max: 100,
                            title: { display: true, text: 'ELCC Capacity Credit (%)' },
                            grid: { color: '#f3f4f6' } 
                        },
                        x: { grid: { display: false } }
                    }
                }
            });
            updateMisoSim();
        }

        function updateMisoSim() {
            const days = parseInt(document.getElementById('slide-drought').value);
            
            // Simplified UEVF EUE * VOLL calculations for demo
            // VOLL = $10k/MWh. A prolonged drought forces high VOLL exposure for electrolyzers buying grid power, 
            // or zero output if behind-the-meter.
            const euePenalty = (days * 1.4).toFixed(1); 
            const firmValue = (days * 2.8 + 0.1).toFixed(1);

            document.getElementById('val-eue').innerText = `-$${euePenalty}M`;
            document.getElementById('val-firm').innerText = `+$${firmValue}M`;
            
            const insightEl = document.getElementById('miso-insight');
            
            if(days === 0) {
                insightEl.innerText = `Standard grid conditions. No severe EUE penalties.`;
            } else if (days <= 3) {
                insightEl.innerText = `A ${days}-day Dunkelflaute forces MISO to dispatch emergency reserves. Electrolyzers face curtailment or massive VOLL penalties. Firm Geologic H2 captures high pricing.`;
            } else {
                insightEl.innerText = `CRITICAL EVENT: A ${days}-day wind drought causes severe MISO load shedding (LOLE violation). Green H2 production is halted. Geologic H2 serves as an essential grid lifeline.`;
            }
        }

        // --- Module: Grid Integration (Plotly) ---
        function initGridChart() {
            const xValues = [10, 20, 30, 40, 50, 60, 70]; // Wind Capacity Factor %
            
            // Geologic H2 is base load, unaffected by wind CF
            const yGeo = Array(7).fill(0.85);
            
            // Green H2 LCOH drops exponentially as Capacity Factor rises (better utilization of electrolyzer CAPEX)
            // Simplified curve: LCOH = Base_Opex + (Capex_factor / CF)
            const yGreen = xValues.map(cf => 1.5 + (120 / cf)); 

            const traceGeo = {
                x: xValues, y: yGeo,
                type: 'scatter', mode: 'lines', line: {color: '#f59e0b', width: 3}, name: 'Geologic H2'
            };

            const traceGreen = {
                x: xValues, y: yGreen,
                type: 'scatter', mode: 'lines', line: {color: '#22c55e', width: 3}, name: 'Electrolytic (Green) H2'
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                margin: {t: 10, l: 40, r: 20, b: 40},
                xaxis: { title: 'Wind Capacity Factor (%)', gridcolor: '#e5e7eb' },
                yaxis: { title: 'LCOH ($/kg)', gridcolor: '#e5e7eb', range: [0, 10] },
                showlegend: true,
                legend: {x: 0.6, y: 0.9}
            };

            Plotly.newPlot('gridChart', [traceGeo, traceGreen], layout, {displayModeBar: false, responsive: true});
            gridPlot = true;
            updateGridSim(); // sync text
        }

        function updateGridSim() {
            if(!gridPlot) return;
            const cf = parseInt(document.getElementById('slide-wind').value);
            document.getElementById('val-wind').innerText = cf + "%";
            
            const insightEl = document.getElementById('grid-insight');
            const greenLCOH = 1.5 + (120 / cf);
            
            if(cf < 30) {
                insightEl.innerText = `At ${cf}% capacity factor, the electrolyzer sits idle too often. Capital costs destroy Green H2 economics (~$${greenLCOH.toFixed(2)}/kg). Geologic H2 is vastly superior.`;
                insightEl.className = "mt-4 text-sm text-stone-700 italic border-l-2 border-red-400 bg-red-50 pl-3 py-2";
            } else if (cf < 50) {
                insightEl.innerText = `At ${cf}% capacity factor, Green H2 costs drop to ~$${greenLCOH.toFixed(2)}/kg. Geologic H2 still maintains a strong price advantage without subsidies.`;
                insightEl.className = "mt-4 text-sm text-stone-700 italic border-l-2 border-amber-400 bg-amber-50 pl-3 py-2";
            } else {
                insightEl.innerText = `At a phenomenal ${cf}% capacity factor, Green H2 approaches ~$${greenLCOH.toFixed(2)}/kg. With heavy 45V subsidies, it can compete with Geologic H2.`;
                insightEl.className = "mt-4 text-sm text-stone-700 italic border-l-2 border-green-400 bg-green-50 pl-3 py-2";
            }
        }

        // --- Module: Workforce (EPACT 1820 & Citrix) ---
        function updateWorkforce() {
            const pen = parseInt(document.getElementById('slide-penetration').value);
            document.getElementById('val-penetration').innerText = pen + "%";
            
            // EPACT 1820 multipliers (simplified for demo)
            // 100% penetration = ~105,000 net jobs, ~117,000 retraining, ~4,800 displaced
            const netJobs = Math.round(1050 * pen);
            const retoolJobs = Math.round(1170 * pen);
            const lossJobs = Math.round(48 * pen);
            
            // Citrix audits (exponential scaling with penetration)
            const audits = Math.round(Math.pow(pen, 1.5) * 14.5);

            document.getElementById('job-net').innerText = "+" + netJobs.toLocaleString();
            document.getElementById('job-retool').innerText = retoolJobs.toLocaleString();
            document.getElementById('job-loss').innerText = "-" + lossJobs.toLocaleString();
            document.getElementById('cyber-audits').innerText = audits.toLocaleString();
        }

        function showAgDetail(stage) {
            const box = document.getElementById('ag-detail');
            let content = "";
            
            switch(stage) {
                case 'h2':
                    content = "<strong class='text-slate-800 text-base'>1. Extraction (Geologic H2)</strong><br><br>Local wells in NE/IA extract hydrogen directly from the subsurface at costs under $1.00/kg. <br><br><span class='font-semibold text-slate-600'>Strategic Impact:</span> Bypasses the need for massive renewable energy buildouts (wind/solar) that consume valuable surface land, and reduces the region's reliance on natural gas imported via pipeline from the Gulf Coast.";
                    break;
                case 'nh3':
                    content = "<strong class='text-blue-800 text-base'>2. Anhydrous Ammonia Production</strong><br><br>The Haber-Bosch process combines Hydrogen with Nitrogen from the air to create Ammonia (NH3) fertilizer. Currently, 80% of the cost of fertilizer is derived from the natural gas used to make the hydrogen. <br><br><span class='font-semibold text-blue-600'>Strategic Impact:</span> Cheap, hyper-local geologic hydrogen translates directly to cheaper, price-stable fertilizer for Midwestern farmers, shielding them from global energy price shocks (e.g., European gas shortages).";
                    break;
                case 'corn':
                    content = "<strong class='text-amber-800 text-base'>3. Agriculture & Yield</strong><br><br>Nitrogen is the primary input driving high corn yields. By using fertilizer made from 'Gold' hydrogen rather than fossil-fuel derived 'Grey' hydrogen, the entire agricultural supply chain immediately reduces its carbon footprint. <br><br><span class='font-semibold text-amber-600'>Strategic Impact:</span> The corn grown now carries a significantly lower 'Carbon Intensity' (CI) score. In modern carbon-regulated markets, lower CI score corn commands a premium price.";
                    break;
                case 'saf':
                    content = "<strong class='text-green-800 text-base'>4. Ethanol & Sustainable Aviation Fuel (SAF)</strong><br><br>Ethanol plants convert the low-CI corn into fuel. Furthermore, the plants themselves can burn geologic hydrogen instead of natural gas for process heat. This ultra-low carbon ethanol is the ideal feedstock to be upgraded into Jet Fuel (SAF). <br><br><span class='font-semibold text-green-600'>Strategic Impact:</span> Under the federal IRA 45Z tax credit, aviation fuel producers receive massive financial incentives for every point they drop their CI score. Local hydrogen makes IA/NE the most lucrative place on earth to refine aviation fuel.";
                    break;
            }
            box.innerHTML = content;
        }

        // --- Module: Regulatory (Simulator) ---
        function updateSocialSim() {
            const val = document.getElementById('sentimentSlider').value;
            const timeDisplay = document.getElementById('sim-time');
            const costDisplay = document.getElementById('sim-cost');
            const analysis = document.getElementById('sim-analysis');

            // Logic: Lower sentiment = Higher time/cost
            // Base: 12 months, 0% premium
            
            let months = 12 + ((100 - val) * 0.6); // Max ~72 months
            let cost = ((100 - val) * 0.5); // Max 50% premium

            timeDisplay.innerText = `${Math.round(months)} Months`;
            costDisplay.innerText = `+${Math.round(cost)}%`;

            if(val < 25) {
                analysis.innerText = "CRITICAL: Widespread protests likely. Legal injunctions will stall project indefinitely. Similar to Keystone XL scenario.";
                analysis.className = "mt-4 text-sm text-red-600 italic border-l-2 border-red-300 pl-3";
            } else if (val < 60) {
                 analysis.innerText = "CHALLENGING: Expect lawsuits over eminent domain. 2-3 year delays typical.";
                 analysis.className = "mt-4 text-sm text-amber-600 italic border-l-2 border-amber-300 pl-3";
            } else {
                 analysis.innerText = "FAVORABLE: Community benefits agreements successful. Standard permitting timeline.";
                 analysis.className = "mt-4 text-sm text-green-600 italic border-l-2 border-green-300 pl-3";
            }
        }

        // --- Module: Outlook (Plotly) ---
        function initOutlookChart() {
            const xValues = [2025, 2026, 2027, 2028, 2029, 2030, 2031, 2032, 2033, 2034, 2035];
            
            // Base Case
            const yBase = [0.1, 0.2, 0.5, 1.2, 2.0, 3.5, 4.8, 6.0, 7.5, 8.8, 10.2];
            // High Case (Optimistic)
            const yHigh = [0.1, 0.4, 1.0, 2.5, 4.5, 7.0, 10.0, 13.5, 17.0, 21.0, 25.0];
            // Low Case (Pessimistic)
            const yLow = [0.1, 0.1, 0.2, 0.3, 0.5, 0.8, 1.2, 1.5, 1.8, 2.0, 2.2];

            const traceBase = {
                x: xValues, y: yBase,
                type: 'scatter', mode: 'lines', line: {color: '#f59e0b', width: 3}, name: 'Base Scenario'
            };

            const traceHigh = {
                x: xValues, y: yHigh,
                type: 'scatter', mode: 'lines', line: {width: 0}, showlegend: false, hoverinfo: 'skip'
            };

            const traceLow = {
                x: xValues, y: yLow,
                fill: 'tonexty', fillcolor: 'rgba(245, 158, 11, 0.2)',
                type: 'scatter', mode: 'lines', line: {width: 0}, showlegend: false, hoverinfo: 'skip'
            };

            const layout = {
                title: 'Projected Economic Impact ($ Billions)',
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                margin: {t: 30, l: 40, r: 20, b: 30},
                xaxis: { title: 'Year', gridcolor: '#e5e7eb' },
                yaxis: { title: 'GDP Impact ($B)', gridcolor: '#e5e7eb' },
                showlegend: true,
                legend: {x: 0, y: 1}
            };

            Plotly.newPlot('outlookChart', [traceLow, traceHigh, traceBase], layout, {displayModeBar: false, responsive: true});
        }
        
        function updateForecast(type) {
             // Mock data update logic
            const el = document.getElementById('outlookChart');
            
            // If we were building a full data store, we'd swap arrays here.
            // For this specific view, we just update the title to reflect the user's choice 
            // as the shape of the curve (S-curve adoption) remains similar for Jobs vs GDP.
            const layoutUpdate = {
                title: type === 'jobs' ? 'Projected Job Creation (Thousands)' : 'Projected Economic Impact ($ Billions)',
                yaxis: { title: type === 'jobs' ? 'Jobs (000s)' : 'GDP Impact ($B)' }
            };
            
            Plotly.relayout(el, layoutUpdate);
        }

        // --- Gemini API Logic ---
        const apiKey = "";
        
        async function callGemini(userText, systemText) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ role: "user", parts: [{ text: userText }] }]
            };
            if (systemText) {
                payload.systemInstruction = { parts: [{ text: systemText }] };
            }
            
            let retries = 0;
            const maxRetries = 5;
            let delay = 1000;

            while (retries <= maxRetries) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) {
                        if (response.status === 429 || response.status >= 500) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        const errData = await response.json();
                        throw new Error(errData.error?.message || "API Error");
                    }
                    const data = await response.json();
                    let rawText = data.candidates?.[0]?.content?.parts?.[0]?.text || "No response generated.";
                    // Strip markdown code fences if Gemini ignores instruction
                    rawText = rawText.replace(/```html/g, '').replace(/```/g, '');
                    return rawText;
                } catch (error) {
                    if (retries === maxRetries) {
                        return `<span class="text-red-600 font-bold">Error:</span> Unable to reach the AI analyst at this time. Please ensure the API key is configured or try again later.`;
                    }
                    await new Promise(resolve => setTimeout(resolve, delay));
                    retries++;
                    delay *= 2;
                }
            }
        }

        async function handleChatSend() {
            const inputEl = document.getElementById('chat-input');
            const historyEl = document.getElementById('chat-history');
            const text = inputEl.value.trim();
            if (!text) return;

            // Append User Message
            historyEl.innerHTML += `
                <div class="bg-amber-100 border border-amber-200 p-4 rounded-xl rounded-tr-sm self-end max-w-[85%] text-sm text-amber-900 shadow-sm">
                    ${text}
                </div>
            `;
            inputEl.value = '';
            historyEl.scrollTop = historyEl.scrollHeight;

            // Append Loading Indicator
            const loadingId = 'loading-' + Date.now();
            historyEl.innerHTML += `
                <div id="${loadingId}" class="bg-slate-200 p-4 rounded-xl rounded-tl-sm self-start max-w-[85%] text-sm text-slate-500 shadow-sm flex items-center space-x-2">
                    <svg class="animate-spin h-4 w-4 text-slate-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    <span>Analyzing...</span>
                </div>
            `;
            historyEl.scrollTop = historyEl.scrollHeight;

            const systemPrompt = "You are an expert energy analyst specializing in Geologic Hydrogen in the Midcontinent Rift System (Iowa/Nebraska). You have deep knowledge of the CAELP 2040 Projections, the 2024 DOE AMRs, the EPACT 1820 Employment Study, the 2025/2026 OBBBA, and MISO Grid Reliability (including MTEP24, LOLE 25-26, UEVF Monetized Risk, VOLL/EUE, and IEEE 2800 IBR requirements). You answer questions based on these documents. Emphasize how Geologic H2 bypasses the interconnection queue and provides firm capacity compared to wind/solar IBRs. Keep your answers concise, professional, and directly related to hydrogen economics, infrastructure, grid reliability, geology, and policy in the Midwest. Format output in clean HTML (e.g. use <b>, <ul>, <li class='ml-4 list-disc'>, <br>) without markdown backticks.";
            
            const responseText = await callGemini(text, systemPrompt);
            
            document.getElementById(loadingId).remove();
            historyEl.innerHTML += `
                <div class="bg-slate-200 p-4 rounded-xl rounded-tl-sm self-start max-w-[85%] text-sm text-slate-800 shadow-sm leading-relaxed space-y-2">
                    ${responseText}
                </div>
            `;
            historyEl.scrollTop = historyEl.scrollHeight;
        }

        async function generateStrategy(event) {
            const outputEl = document.getElementById('ai-strategy-output');
            const sliderVal = document.getElementById('sentimentSlider').value;
            const btn = event.currentTarget;
            
            const origText = btn.innerText;
            btn.innerText = "Drafting Strategy... ‚ú®";
            btn.disabled = true;
            outputEl.classList.remove('hidden');
            outputEl.innerHTML = `
                <div class="flex items-center space-x-3 text-amber-700 font-bold">
                    <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    <span>Consulting AI Policy Expert...</span>
                </div>
            `;

            const systemPrompt = "You are a public relations and regulatory affairs expert in the US energy sector in 2026. Format output in clean HTML (use <b>, <ul class='list-disc ml-5 mt-2 space-y-2'>, <li>, <br>) without markdown backticks.";
            const userPrompt = `The current public sentiment score for a proposed geologic hydrogen gathering pipeline network in the Midwest (Iowa/Nebraska) is ${sliderVal} out of 100 (where 0 is extreme NIMBY hostility and 100 is total YIMBY support). Based on this specific score, draft a concise, tailored 3-point community outreach strategy to improve relations and mitigate permitting delays.`;

            const responseText = await callGemini(userPrompt, systemPrompt);
            
            outputEl.innerHTML = responseText;
            btn.innerText = origText;
            btn.disabled = false;
        }

        // --- Init ---
        // Start at Exec Summary
        window.addEventListener('DOMContentLoaded', () => {
            nav('exec');
        });

    </script>
</body>
</html>
